<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.edu.sdst.mwrdph.admin.mapper.AdminIncidentMapper">
    <select id="getLatest" resultType="cn.edu.sdst.mwrdph.entity.IncidentPO">
        SELECT
        id, section_id, detector_id, type, speed, distance, info, is_checked, created_time, update_time,timestamp
        FROM
        mwr_incident
        <where>
            <if test="detectorId != null">
                detector_id = #{detectorId}
            </if>
        </where>
        ORDER BY
        timestamp DESC
        LIMIT #{limit}
    </select>
    <select id="getIncidents" resultType="cn.edu.sdst.mwrdph.entity.IncidentPO">
        SELECT id,
        section_id,
        detector_id,
        type,
        speed,
        distance,
        info,
        is_checked,
        created_time,
        update_time,timestamp
        FROM mwr_incident
        <where>
            <if test="sectionId != null">
                section_id = #{sectionId}
            </if>
            <if test="start != null">
                AND (created_time BETWEEN #{start} AND #{end})
            </if>
            <if test="checkList!= null">
                AND type in
                <foreach item="checkList" collection="array" separator="," open="(" close=")" index="index">
                    #{item}
                </foreach>
            </if>
        </where>
        ORDER BY
        created_time ASC limit 50
    </select>
    <select id="getIncidentsUnChecked" resultType="cn.edu.sdst.mwrdph.entity.IncidentPO">
        SELECT id,
               section_id,
               detector_id,
               type,
               speed,
               distance,
               info,
               is_checked,
               created_time,
               update_time,
               timestamp
        FROM mwr_incident
        where is_checked = 0
        ORDER BY timestamp ASC
    </select>
</mapper>